<!DOCTYPE html>
<html>
<head>
    <link href="output.css" rel="stylesheet">
    <title>UNSW Classes</title>
</head>
<body>
    <h1 class="text-3xl font-bold underline">UNSW Timetable</h1>
    <button class="button" onclick="clearPage()">CLEAR courses for term</button>

    <form>
        <label for="term">I want to view the courses for term: </label>
        <input class="outline rounded" type="text" id="term" name="term">
    </form>
    <button class="button" onclick="findCoursesForTerm(document.querySelector('#term').value)">Find Term</button>

    <h2 id="coursesForTermTitle" class="text-2xl bold"></h2>
    <h3 id="numCoursesForTerm" class="text-lg italic"></h3>
    <div id="coursesForTerm"></div>
    
    <hr/>

    <form>
        <label for="course">I want to view info for the course code: </label>
        <input class="outline rounded" type="text" id="course" name="course">
    </form>
    <button class="button" onclick="findCourseInfo(document.querySelector('#course').value)">Find Course Info</button>    
    
    <h2 id="courseInfoTitle"></h2>
    <div id="courseInfo"></div>
    <div id="termsCourseOffered"></div>
    <script>
       
        const clearPage = () => {
            document.getElementById("coursesForTermTitle").innerHTML = "";
            document.getElementById("numCoursesForTerm").innerHTML = "";
            document.getElementById("coursesForTerm").innerHTML = "";
        }

        const findCoursesForTerm = (term) => {
            const prettifiedTerm = "T" + term;

            document.getElementById("coursesForTermTitle").innerHTML = "The courses for " + prettifiedTerm + " are: ";

            fetch('data.json')
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                var numCourses = 0;

                var mainContainer = document.getElementById("coursesForTerm")
                
                for (var i = 0; i < data["timetableData"][prettifiedTerm].length; i++) {
                    var div = document.createElement("div")
                    div.innerHTML = data["timetableData"][prettifiedTerm][i]["courseCode"] + " - " + data["timetableData"][prettifiedTerm][i]["name"];
                    mainContainer.append(div)
                    numCourses++;
                }

                document.getElementById("numCoursesForTerm").innerHTML = "There are " + numCourses + " courses!!";

            })
            .catch((error) => {
                console.error("Error: ", error);
            });
        
        }

        const findCourseInfo = (courseCode) => {
            
            // Capitalise the first 4 letters
            prettifiedCourseCode = courseCode.slice(0,4).toUpperCase() + courseCode.slice(4)
            document.getElementById("courseInfoTitle").innerHTML = "Info for the course code " + prettifiedCourseCode + ": ";
            
            fetch('data.json')
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                var mainContainer = document.getElementById("courseInfo")
                mainContainer.innerHTML = ""
                var termsCourseOfferedContainer = document.getElementById("termsCourseOffered")
                termsCourseOfferedContainer.innerHTML = ""

                // Term is currently hardcoded, i.e. we are looking for the course in T2
                // TODO: make the term based on the term the person is searching for
                for (var i = 0; i < data["timetableData"]["T2"].length; i++) {
                    if (data["timetableData"]["T2"][i]["courseCode"] == prettifiedCourseCode) {
                        var div = document.createElement("div")
                        var termsOffered = document.createElement("div")
                        div.innerHTML = "Course Name - " + data["timetableData"]["T2"][i]["name"]
                        termsOffered.innerHTML = "The course is offered in - " + data["timetableData"]["T2"][i]["termsOffered"]
                        mainContainer.append(div)
                        termsCourseOfferedContainer.append(termsOffered)
                    }
                }

            })
            .catch((error) => {
                console.error("Error: ", error);
            });
        }

        
    </script>
</body>
</html>
